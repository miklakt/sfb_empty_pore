\documentclass[10pt, a4paper]{article}
\usepackage{geometry}
\geometry{
    a4paper,
    left= 15mm,
    right = 15mm,
    top=20mm,
    bottom = 25mm,
    }

\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage[
backend=biber,
natbib=true,
style=numeric,
sorting=none
]{biblatex}
\usepackage{xcolor}
\usepackage{mathtools}
\usepackage{bm}
\usepackage{multicol}
\usepackage{ltablex}
\usepackage{wrapfig}
\usepackage{float}

\newcommand\todo[1]{\textcolor{red}{#1}}
\newcommand\scalemath[2]{\scalebox{#1}{\mbox{\ensuremath{\displaystyle #2}}}}

\addbibresource{flow.bib}
\title{Physical principles of the colloid selective permeation through polymer-filled mesopores.\\
        SUPPORTING INFORMATION}

\author{Mikhail Y. Laktionov$^1$, Leonid I.Klushin$^{1,2}$, Ralf P.Richter$^3$, Oleg V.Borisov$^1$\\
$^{1}$CNRS, Universit\'e de Pau et des Pays de l'Adour UMR 5254,\\
Institut des Sciences Analytiques et de Physico-Chimie\\
pour l'Environnement et les Mat\'eriaux, Pau, France \\
$^{2}$Institute of Macromolecular Compounds \\
of the Russian Academy of Sciences, \\
199004 St.Petersburg, Russia,\\
$^{3}$University of Leeds, School of Biomedical Sciences, \\
Faculty of Biological Sciences, 
School of Physics and Astronomy, \\
Faculty of Engineering and Physical Sciences,\\  
Astbury Centre for Structural Molecular Biology,\\ 
and Bragg Center for Materials Research,\\ 
Leeds, LS2 9JT, United Kingdom}

\begin{document}
\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{List of variables and abbreviations}

\begin{tabularx}{\linewidth}{l l}
$k_B$ & Boltzmann constant \\
$T$ & temperature \\
$a$ & Kuhn segment length \\
$\sigma$ & grafting density, number of polymer chains per unit area \\
$N$ & number of Kuhn segments in the brush forming chains \\
$s$ & membrane thickness \\
$r_{\textrm{pore}}$ & radius of the pore \\
$r^{\ast}_{\textrm{pore}}$ & radius of the pore with excluded volume \\
$d$ & spherical particle diameter, cylindrical particle diameter and height \\ 
$\chi_{\textrm{PS}}$ & Flory polymer-solvent interaction parameter  \\
$\chi_{\textrm{PC}}$ & Flory polymer-colloid interaction parameter  \\
$\chi_{\textrm{CS}}$ & Flory colloid-solvent interaction parameter  \\
$z$ & a coordinate on the axis of the cylindrical coordinates coaxial to the pore \\
$r$ & radial coordinate of the cylindrical coordinate system \\
$z_{c}, r_{c}$ & coordinates of the colloid particle center in cylindrical coordinates \\
$\Delta F$ & analytical insertion free energy penalty to place spherical particle \\
$\Delta F_{\textrm{osm}}$ & osmotic contribution to analytical insertion free energy penalty to place spherical particle \\
$\Delta F_{\textrm{sur}}$ & surface contribution to analytical insertion free energy penalty to place spherical particle \\
$\Delta F_{\textrm{SF}}$ & insertion free energy penalty to place cylindrical particle calculated using Scheutjens-Fleer approach \\
$\xi$ & semi-dilute polymer solution correlation length \\
$\phi$ & local volume concentration of the polymer segments in an polymer brush\\
$\phi^{\textrm{ins}}$ & local volume concentration of polymer segments disturbed by an inserted particle\\
$\Delta \phi$ & change in the volume concentration of polymer segments when colloid particle is present \\
$\phi^{\ast}$ & apparent local volume concentration of polymer segments \\
$\Pi$ & Flory mean field local osmotic pressure \\
$\gamma$ & surface tension coefficient \\
$b_0, b_1$ & depletion/accumulation correction coefficient \\
$\textbf{V}(r_{c})$ & particle volume occupation matrix for a spherical particle with the radial coordinate of the center $r_{c}$ \\
$\textbf{S}(r_{c})$ & particle surface occupation matrix for a spherical particle with the radial coordinate of the center $r_{c}$ \\
$c$ & stationary local concentration of diffusing colloid particles \\
$c^{\textrm{empty}}$ & the stationary local concentration of diffusing colloid particles through a pore with no polymer brush \\
$c_0$ & concentration of diffusing colloid particles in the bulk \\
$D$ & local colloid particle diffusion coefficient \\
$D_0$ & colloid particle diffusion coefficient in the pure solvent \\
$R$ & total resistance of the pore to colloid particle diffusion in a semi-infinite solution \\
$R^{\textrm{empty}}$ & total resistance of the pore with no polymer brush to colloid particle diffusion in a semi-infinite solution \\
$R_{\textrm{conv}}$ & the convergent flow contribution to total resistance \\
$R_{\textrm{channel}}$ & the contribution from the pore's channel to the total resistance \\
$R^{\textrm{empty}}_{\textrm{conv}}$ & the convergent flow contribution to the total resistance of the pore with no polymer brush \\
$R^{\textrm{empty}}_{\textrm{channel}}$ & the contribution from the pore's channel to the total resistance of the pore with no polymer brush \\
$P$ & permeability of the pore to colloid particle diffusion in semi-infinite solution \\
$\eta_{0}$ & dynamic viscosity of the pure solvent \\
$\textrm{PC}$ & colloid particle partition coefficient between the bulk and the polymer brush \\
$J$ & stationary net flux of colloid particles through the pore \\
$j$ & stationary colloid particles flux density \\
$\rho^{-1}$ & local conductivity to colloid particle diffusion \\
\\
$\nabla_{V} j$ & flux divergence of a lattice element \\
$\textrm{n,e,s,w}$ & lattice element face indices; namely \textit{north, east, south, west} \\
$\textrm{N,E,S,W,C}$ & neighboring lattice element indices; namely \textit{north, east, south, west, center} \\
$\lambda_{\textrm{n}}$ & ratio of neighboring lattice element volumes in the given direction \\
$j_{\textrm{n}}$ & flux density between neighboring lattice elements in the given direction \\
$j^{\textrm{pot}}_{\textrm{n}}$ & potential flux density between neighboring lattice elements in the given direction \\
$j^{\textrm{dif}}_{\textrm{n}}$ & diffusive flux density between neighboring lattice elements in the given direction \\
$\alpha_{\textrm{n}}$ & neighboring lattice element weights used to calculate the concentration on the face in a given direction \\
$\textrm{Pe}_{\textrm{n}}$ & the PÃ©clet number for a flux between neighboring lattice elements in the given direction \\
$c_{\textrm{N}}$ & concentration in the neighboring or current lattice element \\
$c_{\textrm{n}}$ & concentration at the face between the current and a neighboring lattice element \\ 
$c^{t}_{\textrm{C}}$ & concentration in the current lattice element at a given time $t$ \\ 
$D_{\textrm{N}}$ & local diffusion coefficient in the neighboring lattice element \\
$D_{\textrm{n}}$ & local diffusion coefficient at the face between the current and a neighboring lattice element \\
\\
CFD & Computational Fluid Dynamics \\
SF-SCF & Scheutjens-Fleer Self-Consistent Field \\
NPC & Nuclear Pore Complex \\
NTR & Nuclear Transport Receptor \\
MEP & Microtubule Intrinsic Proteins \\
FJC & Free-Joined Chain \\
FFT & Fast Fourier Transform \\
\end{tabularx}
\pagebreak

\begin{figure*}
    \centering
    \includegraphics[scale = 1.0]{fig/pore_cartoon_SI.png}
    \caption{
        Schematic illustration of colloid particle interaction and diffusive transport through a polymer brush-filled pore. 
        The brush is formed by linear polymer chains (red strands) with a degree of polymerization $N$, uniformly grafted with grafting density $\sigma$ to the inner surface of a cylindrical pore in an impermeable membrane. 
        The pore radius is $r_{pore}$ and the thickness of the membrane is $s$.
        Polymer chains are flexible with a statistical segment length $a$ and volume $\sim a^3$.
        \\
        The local mobility of the particles in the solvent $D/D_{0}$ is defined by their size ($d$), and the presence of polymer chains impedes colloid transport by decreasing local mobility.
        To calculate the insertion free energy of the polymer brush, solvent and particle coarse-grained into regular elements (lower inset) having finite volume and contact area.
        The short-ranged interactions are modeled as the contacts of the coarse grained elements.
        \\
        The energy of 
        \textbf{p}olymer brush - \textbf{c}olloid particle (PC), 
        \textbf{p}olymer brush - \textbf{s}olvent -  (PC),  
        and \textbf{c}olloid particle - \textbf{s}olvent (CS) contacts defined by the Flory interaction parameters $\chi$ (upper inset).
        }
        \label{fig:colloid_transport_SI}
\end{figure*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Brief summary of the computation routines}
\begin{multicols}{2}

The paper is naturally split between the main text and the Supplementary Information. 
The main results, condensed description, and simplified formalism are presented in the main text.
An extended explanation of the used method and routines is presented here for interested readers. 

Each of the methods used in this paper has its shortcomings, and we put our best efforts to forego these shortcomings by combining different approaches in a complimentary manner. 
To reflect this, the next narrative goes together with a roadmap of the paper in Figure \ref{fig:paper_roadmap}.

Let us start from the end. 
The particular interest of this paper was to calculate the resistance $R$ of a cylindrical polymer brush-filled mesopore in a membrane to the diffusion of nanocolloid particles. 
The inner surface of the pore is decorated with a polymer chains densely grafted to the inner surface, forming a polymer brush.

In the Figure \ref{fig:colloid_transport_SI} we schematically show nanocolloid particles interaction and diffusive transport through the mesopore.
Naturally, even a simple pore with no polymer brush is permeation selective (permselective), the polymer brush modulates nanocolloid transport in a complex manner.
In Figure \ref{fig:colloid_transport_SI} we intended to present some key features.
\\
First, the effects of the polymer brush is weakened for smaller particles, so that even repelled by the brush particles can come through.
\\
Second, larger particles repelled by the brush (magenta) can not pass, due to the high energy barrier.
Finally, The presence of a polymer brush changes the local diffusion coefficient $D$ compared with the diffusion coefficient in the pure solvent $D_0$, and the short-range interaction of polymer with the solvent and colloid particle creates energy landscape.
The short-range interaction modeled as coarse-grained elementary contact interaction, of polymer, solvent and colloid particles, with the contact energy defined by the Flory interaction parameters.

To find the nanocolloid flux through such pores and the pore resistance, the problem is formulated as massless particle diffusion in potential field.
Depending on the context, applicable equations are called Focker-Plank equation in the limit of strong friction, advection-diffusion or drift-diffusion equation, and finally the Smouluchowsky diffusion equation.
We are interested in the stationary solution $\partial c_t = 0$ of the Smouluchowsky equation.

The key components that define the Smouluchowsky equation are the local diffusion coefficient $D$ and the insertion free energy $\Delta F$ (potential field). 


The local diffusion coefficient depends on the polymer volume concentration $\phi$ and particle size. 
The polymer brush forms a polymer solution with a concentration-dependent correlation length $\xi$. 
Particles with a size $d>\xi$ experience additional friction of the polymer mesh. 
As a result, the diffusion is slowed down compared to the pure solvent $D_0/D<1$.

The effects were studied and several models were proposed [refs\dots]. 
In this paper we chose the model proposed by the authors in [\dots].
The model assumes a non-sticky particles, and tends to overestimate the diffusion coefficient for particles with high affinity to the polymer.

As mentioned before, the second component to define the Smouluchowsky equation is the insertion free energy. 
When a nanocolloid particle is inserted into a brush, the free energy of the system is changed compared with that of the particle in the bulk solution. 

In the analytic approach the insertion free energy can be split into two terms: osmotic $F_{\textrm{osm}}$ and surface $F_{\textrm{sur}}$; that scales with particle volume and surface, respectively.

To calculate the osmotic term, the Flory osmotic pressure is integrated over the particle volume, which depends on the local polymer volume concentration $\phi$ and polymer-solvent interaction parameter $\chi_{\textrm{PS}}$.
The surface contribution is proportional to the particle surface, with a surface tension coefficient $\gamma$ and found by integrating over the particle surface.

The surface tension coefficient $\gamma(\phi, \chi_{\textrm{PS}}, \chi_{\textrm{PC}})$ has non-trivial dependency on the local polymer volume concentration, the polymer-solvent interaction parameter $\chi_{\textrm{PS}}$ and the polymer-colloid interaction parameter $\chi_{\textrm{PC}}$.
The problem becomes even more complex as the polymer volume concentration $\phi^{\textrm{ins}}$ in the vicinity of the inserted particle becomes distorted compared to the empty brush $\phi$, forming a depletion region $\Delta \phi <0$ for inert and slightly attractive particles and a region enriched with polymer $\Delta \phi >0$ for attractive particles ($\Delta \phi = \phi^{\textrm{ins}} - \phi$).

To the best of our knowledge, there is no general purely analytical solution to calculate the surface tension coefficient $\gamma$ for a given particle size and local polymer concentration $\phi$.
To account for local distortion in the polymer volume concentration $\phi$ we introduce correction to the polymer volume concentration of the empty brush $\phi$ with coefficient $b_0, b_1$, making apparent $\phi^{\ast}$ volume concentration dependent on the polymer-colloid interaction parameter $\chi_{\textrm{PC}}$ to compute the corrected surface tension coefficient $\gamma(\phi^{\ast},\chi_{\textrm{PS}}, \chi_{\textrm{PC}})$.

The correction coefficient $b_0, b_1$ can be found by fitting, given the particle size $d$, polymer concentration profiles $\phi$ and interaction parameters $\chi_{\textrm{PS}}, \chi_{\textrm{PC}}$ and $\Delta F$ are known.


However, within the chosen framework, the insertion free energy $\Delta F$ for a spherical particle with an arbitrary diameter $d$ and coordinates of the center $z_c, r_c$ is not accessible, and we still miss the local polymer concentration of the empty undisturbed polymer brush $\phi$ to calculate the osmotic pressure $\Pi$ and surface tension coefficient $\gamma$.
This motivates us to employ another approach to calculate missing features. 
In this paper Scheutjens-Fleer Self-Consistent Field (SF-SCF) approach is used.

The SF-SCF numerical method can be used to find the equilibrium distribution of chain molecules.
In this method, the space is discretized into a regular lattice, and the average volume fraction of the molecules is calculated in each lattice site, such that the overall system free energy is minimized.
In the core of the method is iterative search for segment potential $\mathbf{u}$ and consistent with it polymer volume concentration $\phi$, such that the Helmholtz energy of the system is minimized.

Finally, the roadmap in Figure \ref{fig:paper_roadmap} starts with control parameters that define the geometrical features of the pore, polymer brush morphology, particle size, and interaction parameters.
See some of the the control parameters in Figure \ref{fig:colloid_transport_SI}.

\begin{figure}[H]
    \includegraphics[width = \linewidth]{fig/roadmap.png}
    \caption{Roadmap of the paper and calculation routines}
    \label{fig:paper_roadmap}
\end{figure}

\end{multicols}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{The SF-SCF numerical method}
\begin{multicols}{2}


The method is based on the minimization of the excess Helmholtz energy with a constrain of all volume concentrations end up to unity (incompressibility condition).
The method use discrete space coordinates, as the system exhibit axial symmetry, and the space is discretized into homogeneously curved two gradient lattices \emph{i. e.} cylindrical lattice with degenerate angular direction.
The result is discrete density profile that correspond to a minimum excess Helmholtz energy.

There are two coordinate axes: longitudinal $z$ and radial $r$ (Figure \ref{fig:sf-scf_scheme}). 
While $rz$ coordinate system looks identical to the two dimensional Cartesian coordinates (Figure \ref{fig:sf-scf_scheme} lower frame) in the figures, each element of the lattice is square toroid, the mean-field approximation is applied in angular direction, means properties in angular direction are uniform.
(For the two dimensional Cartesian coordinates each element is square box with an infinite height.)

In the discrete space the membrane and an inserted colloid particle are coarse-grained, and defined as the lattice elements impermeable for the solvent and polymer.
The impermeable lattice elements are illustrated with crossed out cells filled with green (membrane) and yellow (colloid particle) in  the lower frame of Figure \ref{fig:sf-scf_scheme}.
In this discrete coarse-grained approach the membrane is modeled as a rectangle toroid with the inner radius equal to $r_{\textrm{pore}}$ and the outer radius much greater than the inner radius.
The inserted particle is modeled as a cylinder with height and diameter $d$.

The polymer chain modeled as free-joined chain (FJC) with segment length $a$, every next segment performs step-weighted random walk on the lattice (red chain in Figure \ref{fig:sf-scf_scheme}).
The weights of each step direction depend on the boundary condition and the lattice curvature, for example, steps that ends up in the impermeable lattice cells have zero weights; in the cylindrical lattice steps to the cells within the layer with lower curvature (larger radial coordinate) are more preferable.
The resulting local polymer concentration of the polymer $\phi$ is weighted sum of all possible paths the chain can take.


To minimize excess Helmholtz energy we introduce a Lagrangian with a multipliers $\alpha(r,z)$
\begin{equation}
    \label{eq:fe_lagrangian}
    \begin{aligned}
    &F[\mathbf{u}, \boldsymbol{\phi}, \boldsymbol{\alpha}] =\\
    &= F_{ent}[\mathbf{u}] - \sum\limits_{r,z} \sum\limits_X u_X(r, z) \phi_X(r, z) + \\
    &+ F_{int} [\boldsymbol{\phi}] 
    + \sum\limits_{r,z} \alpha(r, z) \left( \sum\limits_X \phi_X(r, z) - 1 \right)
    \end{aligned} 
\end{equation}

where $\phi_X(x, z)$ is local volume concentration function of segment type $X$ (polymer, colloid or solvent), $u_X(x, z)$ is a potential field of segment type $X$, functional $F_{ent}[\mathbf{u}]$ is mixing entropy term, functional $F_{int} [\boldsymbol{\phi}]$ is the interaction part of free energy. 


The first conditions in eq.\ref{eq:energy_min_system} assures system incompressibility.

\begin{figure}[H]
    \centering
    \includegraphics[scale = 0.9]{fig/sf-scf_scheme.png}
    \caption{
    Schematic layout of the lattice and geometrical features of the cylindrical pore model in the SF-SCF method.
    The modeled objects are in the upper frame, and their representation on a discrete two gradient lattice is on the lower frame.
    }
\label{fig:sf-scf_scheme}
\end{figure}


The second condition result in eq.\ref{eq:energy_min_system} is the segment potential field equation for regular solution:
\begin{equation}
    \label{eq:u-phi}
    u_A(x, z) =\sum\limits_{B} \chi_{A,B} \left(\phi_B(x,z) - \phi_B^b \right) + \alpha(x, z)
\end{equation}
where $\chi_{A,B}$ is parameter Flory between segments $A$ and $B$, and $\phi_B^b$ is volume fraction of $B$ in the bulk (equal to 1 for the solvent and zero otherwise).


The condition for the minimum of the functional is a system of three variations:
\begin{equation}
    \label{eq:energy_min_system}
    \begin{cases}
        \frac{\partial F}{\partial \boldsymbol{\alpha}} = 0 \\
        \frac{\partial F}{\partial \boldsymbol{\phi}} = 0 \\
        \frac{\partial F}{\partial \mathbf{u}} = 0 \\
    \end{cases}
\end{equation}

Minimization with respect to potentials (third condition in eq.\ref{eq:energy_min_system}) links the chain partitioning function with local polymer concentration $\phi$ in a diffusion like equation (eq. \ref{eq:propagation}).

The FJC can be considered a Markov process starting at some segment $s_{i}$ at coordinate $r_{i}, z_{i}$ that goes through intermediate step to the segment $s_{k}$ and coordinate $r_{k}, z_{k}$ (red chain in Figure \ref{fig:sf-scf_scheme}).
Such process has a statistical weight $G(\{r_{k}, z_{k}\}, s_{k} | \{r_{i}, z_{i}\}, s_{i})$.

All the Markov processes that starts with the segment $s_{i}$ and ends with the segment $s_{k}$ at coordinates ${r, z}$ found as the sum over all possible starting coordinates:
\begin{equation}
    G(\{r, z\}, s_{k} | s_{i}) = \sum_{r^{\prime}, z^{\prime}} G(\{r, z\}, s_{i} | \{r^{\prime}, z^{\prime}\}, s_{i})
\end{equation}

The statistical weight of all possible processes that starts form the segment $s_{i}$ and ends with the segment $s_{k}$ is a the sum over all possible coordinates:
\begin{equation}
    G(s_{k} | s_{i}) = \sum_{r, z} G(\{r, z\}, s_{k} | s_{i})
\end{equation}

When $s_{i}=1$ and $s_{k}=N$ the result contains the statistical weight of all possible and allowed conformation of the chain, and is the single chain partition function $G(N|1)$

Let $G(r, z) = G(\{r, z\}, 1|1)$ be the initial conditions of the Markov process, which contains just one segment (starts and ends at segment $1$).
The segment potential $\mathbf{u}$ acts on this segment, thus Boltzmann statistical weights are applied:

\begin{equation}
    G(r, z) = \exp(-u(r,z))
\end{equation}

The volume density distribution of a segment $s_i$ at a coordinate $r_{i}, z_{i}$ is found from the composition law:
\begin{equation}
    \label{eq:propagation}
    \begin{aligned}
        &\phi(\{r, z\}, s_{i}) = \\
        &\frac{2 \pi r_{\textrm{pore}} \sigma N}{G(N|1)}
        \frac{G(\{r, z\}, s_n | 1) G(\{r, z\}, (N-s_n+1) | 1)}{G(r, z)}
    \end{aligned}
\end{equation}
where $G(\{r, z\}, s_n | 1)$ and $G(\{r, z\}, (N-s_n+1) | 1)$ are forward and backward propagators, respectively; $\sigma$ is grafting density and $N$ is the chain length.

Finally, the volume concentration at a coordinate $r, z$ is found as the sum over the all chain segments:
\begin{equation}
    \phi(r, z) = \sum_{i}^{N} \phi(\{r, z\}, s_{i})
\end{equation}

Numerical algorithm solve Scheutjens-Fleer system of non-linear equations, such that the segment potential $\mathbf{u}$ is consistent with the volume concentration $\mathbf{\phi}$.
The relationship between segment potential and volume concentration is defined in eq. \ref{eq:u-phi}.

The SF-SCF scheme can be is summarized as:
\begin{equation}
    \bm{u}[\bm{\phi}] \xleftrightarrow[]{\sum_{X} \phi_X = 1} \bm{\phi}[\bm{u}]
\end{equation}

For the calculations we use the package \emph{SFbox} kindly provided by F.A.M. Leermakers [\dots].
The package contains several Newton/Quasi-Newton optimization routines to perform minimization of the functional eq.\ref{eq:fe_lagrangian}.
Each iteration returns a new improved approximation to segment potential $\mathbf{u}$, and updates volume concentrations.
The routine loops until the desired accuracy is reached.

\end{multicols}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Integration over cylindrical particle in the discrete cylindrical lattice}

\begin{multicols}{2}
The analytical approach to calculate insertion free energy $\Delta F$ requires the integration over the particle.
Let us start with the continuous form, the analytical insertion free energy for cylindrical co-axial with $z$-axis can be written as follows:

\begin{equation}
    \Delta F_{\textrm{cyl}}^{\textrm{osm}}(z_c) = 2 \pi \int_{z_c-d/2}^{z_c+d/2} \int_{0}^{d/2} \Pi(z, r) r dr dz
\end{equation}


\begin{equation}\label{eq:continuous_surf_int}
    \begin{aligned}
        &\Delta F_{\textrm{cyl}}^{\textrm{sur}}(z_c) = 2 \pi d \int_{z_c-d/2}^{z_c+d/2} \gamma(z,d/2) dz +
        \\
        &+ \pi \int_{0}^{d/2} \left[\gamma(z_c-d/2, r) + \gamma(z_c+d/2,r)\right] dr
    \end{aligned}
\end{equation}

In the eq.\ref{eq:continuous_surf_int} the second term integrates surface tension coefficient over cylindrical particle base, the first integrates over the element of the cylinder.

The SF-SCF results are defined as discrete values, each continuous property has a counterpart matrix, for example, $\phi(z,r)$ and $\bm{\phi}$ indexed with $i,k$.

We follow the next convention for indices: $i$ iterates in the direction of $r$-axis with larger values corresponds to the lattice element in the layer further from $z$-axis, the indices starts with $0$.

Let us switch to the integration on the cylindrical lattice, consider, a particle with the coordinate of the center $r_c=0$, $z = z_{c}$, the particle occupies a number of lattice elements $d$ horizontally, and $d/2$ vertically (yellow rectangle in the lower frame of Figure \ref{fig:sf-scf_scheme}).

We define the particle volume projection matrix $\mathbf{V}_{\textrm{cyl}}[d/2 \times d]$ for a cylindrical particle of size $d$, such that each element of the matrix equal to the volume of the particle bound within the lattice element.
Obviously, the sum of all matrix elements equals to the cylindrical particle volume.
\begin{eqnarray}
    V_{\textrm{cyl}}[i, k] = \pi(2i + 1)
    \\
    \sum_{i=0}^{d/2-1} \sum_{k=0}^{d-1} V_{\textrm{cyl}}[i, k] = \frac{\pi d^3}{4}
\end{eqnarray}

We define the particle surface projection matrix  $\mathbf{S}_{\textrm{cyl}}[d/2 \times d]$ such that each element of the matrix equal to the surface of the particle bound within the lattice element.

\begin{figure}[H]
    \centering
    \includegraphics[width = \linewidth]{fig/cylindrical_kernel_SI.png}
    \caption{Volume and surface projection matrices for cylindrical particle with the diameter and height $d=8$}
    \label{fig:cylindrical_kernel_SI}
\end{figure}

\begin{align}
    \begin{split}
        &S_{\textrm{cyl}}[i,k] = 
        \\
        &\begin{cases}
            2 \pi i,   & \text{if}\ i=d/2-1 \\
            0,         & \text{otherwise}
        \end{cases}
    +
    \\
    +
    &\begin{cases}
        2\pi(i+1), & \text{if}\ k=0 \text{ or } k=d-1 \\
        0,         & \text{otherwise}
    \end{cases}
\end{split}
\end{align}
Where the first term accounts for the base of the cylindrical body of the particle, and the second accounts for the element of the cylindrical body.

Again, the sum of all matrix elements equals to the cylindrical particle surface.
\begin{equation}
    \sum_{i=0}^{d/2-1} \sum_{k=0}^{d-1} S_{\textrm{cyl}}[i, k] = \frac{3 \pi d^2}{2}
\end{equation}

In Figure \ref{fig:cylindrical_kernel_SI} we present a color visualization for the volume $\mathbf{V}_{\textrm{cyl}}$ and surface $\mathbf{V}_{\textrm{cyl}}$ projection matrices of a cylindrical particle with the diameter and the height $d=8$.
In fact, the construction of this matrices are a particular case of the discrete Radon transform in cylindrical coordinates, we discuss it later in the SI.
The panels in Figure \ref{fig:cylindrical_kernel_SI} are geometrical tomograms of the volume and the surface of a particle, with particle volume and surface casting the 'shadows'.

To calculate analytical insertion free energy we integrate osmotic pressure over the particle volume and surface tension coefficient over the surface.
The integration on a discrete lattice can be defined as the matrix dot product, for example, the osmotic term $\Delta F_{\textrm{cyl}}^{\textrm{osm}}(z_c)$ is calculated as follows:
\begin{equation}\label{eq:cyl_fe_osm}
    \begin{split}
        \Delta F_{\textrm{cyl}}^{\textrm{osm}}(z_c) &= \sum_{i=0}^{d/2-1} \sum_{k=0}^{d-1} V_{\textrm{cyl}}[i, k] \cdot \Pi[i, z_c-d/2+k] 
        \\   &= \mathbf{V}_{\textrm{cyl}} \cdot  \bm{\Pi}\{z_c\}
        \\ \text{where } &\bm{\Pi}\{z_c\} =\left(\bm{\Pi}_{i,k}\right) {\substack{0 \le i < d/2 \\ z_c-d/2 \le k < z_c+d/2}}
    \end{split}
\end{equation} 

Similarly, we define the surface term:
\begin{equation}\label{eq:cyl_fe_sur}
    \Delta F_{\textrm{cyl}}^{\textrm{sur}}(z_c) = \mathbf{S}_{\textrm{cyl}} \cdot  \bm{\gamma}\{z_c\}
\end{equation}

Analytical insertion free energy profile $\left[\Delta F_{\textrm{cyl}}\right]$ is defined as a series of insertion free energy calculation performed for all possible particle center positions $z_c$.
Such series of sequential integrations (matrix dot products) is equivalent to the convolution with particle volume/surface projection matrix acting as a kernel.
\begin{eqnarray}
    \Delta F_{\textrm{cyl}}^{\textrm{osm}} = \mathbf{\Pi} \ast \mathbf{V}_{\textrm{cyl}}
    \\
    \Delta F_{\textrm{cyl}}^{\textrm{sur}} = \bm{\gamma} \ast \mathbf{S}_{\textrm{cyl}}
\end{eqnarray}
We remind, that a cylindrical particle is always coaxial to the $z$- axis, thus $\Delta F_{\textrm{cyl}}^{\textrm{osm}}$ and  $\Delta F_{\textrm{cyl}}^{\textrm{sur}}$ are one dimensional arrays.
It is worth to note, that the convolution is computationally efficient operation, often done via FFT (Fast Fourier Transform).


\end{multicols}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Mapping between SF-SCF and analytical approaches. Correction coefficients}
\begin{multicols}{2}

In the previous sections we discussed how insertion free energy profile for a cylindrical particle coaxial to $z$-axis can be calculated with the numerical SF-SCF approach ($\Delta F_{\textrm{SF-SCF}}$), and analytically ($\Delta F_{\textrm{cyl}}$).
The analytical approach use only local polymer concentration of unperturbed polymer brush $\phi$.
The main premise of the analytical approach is separation of insertion free energy into two contributions:
\begin{eqnarray}
    \Delta F = \Delta F_{osm} + \Delta F_{sur}
    \\
    \Delta F_{osm} = \int_{V} \Pi(z,r) dV
    \\
    \Delta F_{sur} = \oint_{S} \gamma (z,r) dS
\label{Delta_F}
\end{eqnarray}

The osmotic contribution is found using the Flory mean field approach, while the surface contribution requires coefficients $b_0, b_1$ we introduced to the analytical approach:
\begin{eqnarray}
    \gamma = \frac{1}{6}(\chi_{\textrm{ads}} - \chi_{\textrm{crit}})\phi^{\ast}
    \\
    \chi_{\textrm{ads}} = \chi_{PC} - \chi_{PS}(1-\phi^{\ast})
    \\
    \phi^{\ast}= (b_{0} + b_{1}\chi_{PC})\phi \label{eq:phi_correction}
\end{eqnarray}
Here $\gamma$ is a free energy change upon replacement of a contact of the unit surface area of the particle with the pure solvent by a contact with polymer solution of concentration $\phi$.
%$\chi_{\teextrm{crit}}$ is critical adsorption condition

We made a large number of SF-SCF computations with the particle center position $z_{c}$ moved along $z$-axis, varying particle size $d$ and interaction parameters $\chi_{\textrm{PS}}$ and $\chi_{\textrm{PC}}$. 
From the results of the SF-SCF computations we constructed a set of insertion free energies $\Delta F_{\textrm{SF-SCF}}$, indexed with a set of control parameters $(z_c, d, \chi_{\textrm{PS}}, \chi_{\textrm{PC}}, \dots)$.

The insertion free energy profile $\Delta F_{\textrm{SF-SCF}}(z_c)$ is gathered into series with fixed particle size $d$, fixed parameters of the pore ($r_{\textrm{pore}}, s$) and the brush ($N, \sigma$), as well as fixed interaction parameters $\chi$.
For each of this series we performed the ground state free energy correction, means that the total free energy for a particle far away from the pore are subtracted to assure reference value $\Delta F(z_c \to \pm \infty) = 0$.

The particle sizes were ranged from small $d=4$ to  larger $d=32$ particle's height and diameter.
The interaction parameters were ranged from poor $\chi_{\textrm{PS}} > 0.5$ to good solvent $\chi_{\textrm{PS}} < 0.5$, and from repelling  $\chi_{\textrm{PC}} > \chi_{\textrm{PC}}^{\textrm{crit}}$ to attractive $\chi_{\textrm{PC}} < \chi_{\textrm{PC}}^{\textrm{crit}}$ colloid particles, where $\chi_{\textrm{PC}}^{\textrm{crit}} = \chi_{\textrm{crit}} + \chi_{\textrm{PS}}(1-\phi)$.

A set of insertion free energies $\Delta F_{\textrm{cyl}}(b_0, b1)$ can be computed analytically (described in the previous section) for the same set of control parameters if the correction coefficient $b_0, b_1$ are known.

We chose to perform the fit using only smaller particles with the diameter and height $d=4$, to exclude large perturbation to the polymer volume concentration $\phi$. The found correction coefficient $b_0, b_1$ minimize the difference between $\Delta F_{\textrm{SFF}}$ and $\Delta F_{\textrm{cyl}}(b_0, b1)$.

While the fit were done only for the smaller particles, the insertion free energies calculated by the both approaches $\Delta F_{\textrm{SF}}$ and $\Delta F_{\textrm{cyl}}$ fit well up to particles with the diameter and the height smaller than $d=16$ (main text Figure 3) for a wide set of control parameters $z_c, \chi_{\textrm{PS}}, \chi_{\textrm{PC}}$.

To illustrate the effect of the fit, in Figure \ref{fig:fit_SI} we compare SF-SCF and analytical results of the insertion free energy penalty $\Delta F_{\textrm{SF}}$ and $\Delta F_{\textrm{cyl}}$ as a function of the particle center $z_c$ for small cylindrical particles with the diameter and the height $d=4$ for the different affinities ($\chi_{\textrm{PS}} = 0.00, -0.75, -1.50$) in the $\theta$-solvent, $\chi_{\textrm{PS}} = 0.5$.
We treat the SF-SCF results as the reference values for our analytical approach (circle markers in Figure \ref{fig:fit_SI}).

Let us assume particle insertion cause no perturbation to the polymer brush then in eq.\ref{eq:phi_correction} $\phi^{\ast} = \phi$ and $b_0 = 1, b_1 = 0$ (dashed line in Figure \ref{fig:fit_SI}).
The results diverges from the SF-SCF predictions for the inert $\chi_{\textrm{PC}} = 0$ and strongly adsorbant particles $\chi_{\textrm{PC}} = -1.5$.
Interestingly, the analytical results fit well to the SF-SCF for the particle at critical adsorption conditions $\gamma \approx 0$ and $\chi_{\textrm{PC}} = -0.75 \approx \chi_{\textrm{PC}}^{\textrm{crit}}$.

We anticipate that, for small particles, most of the non-local effects can be neglected, hence near the critical adsorption condition the non-fitted results coincide with SF-SCF predictions.

An interesting effect can be observed for the strongly attractive particle, SF-SCF results predicts that, to reach the minimum of the insertion free energy $\Delta F_{\textrm{SF}}$, the polymer brush changes the conformation to reach the particle at a further distance $|z_c|$ from the pore.
In the Figure \ref{fig:fit_SI} the effect is apparent for the $\chi_{\textrm{PC}} =-1.5$ result (blue curves and markers), where the SF-SCF results predict systematically lower insertion free energy than the analytical approach at $|z_c| > 26$

A detailed look on the polymer volume concentration profile and its perturbation upon particle insertion is shown in the Supplementary Movie [\dots] as animated figures similar to Figure \ref{fig:particle_insertion}.

\begin{figure}[H]
    \centering
    \includegraphics[scale = 0.9]{fig/fit_SI.png}
    \caption{Fitted and non-fitted results compared to SF-SCF, $d=4$}
    \label{fig:fit_SI}
\end{figure}

\end{multicols}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Non-local effects of particle size and position on the polymer volume concentration}
\begin{multicols}{2}
In the main text and in the previous section of SI we discussed the particle insertion free, in particular, the effect of particle size $d$ and interaction parameters $\chi_{\textrm{PS}}, \chi_{\textrm{PC}}$.
As mentioned in the previous chapter, the analytical approach can correctly calculate insertion free energy for a wid set of control parameters $z_c, \chi_{\textrm{PS}}, \chi_{\textrm{PC}}$, which the result of the fit on SF-SCF data.

In Figure\ref{fig:particle_insertion}a we present polymer volume concentration $\phi^{\textrm{ins}}$ colormaps for a polymer brush in a cylindrical mesopore with an inserted cylindrical particle (green square) with the height and the diameter $d=16$ comparable to the pore radius $r_{\textrm{pore}}=26$ and the membrane thickness $s=52$ (hatched green rectangles).
The polymer volume concentration profiles are computed for an inert $\chi_{\textrm{PC}} = 0.0$ (upper subfigure) and a strongly attractive particle $\chi_{\textrm{PC}} = -1.5$ (lower subfigure) placed at the pore's entrance $|z_c| = 26$.

The color code is shown in the legend Figure\ref{fig:particle_insertion}d, where white color corresponds to pure solvent, yellow to magenta is low polymer concentration, blue to black correspond to high concentration.

Alongside the polymer volume concentration $\phi^{\textrm{ins}}$ of the polymer brush distorted by the inserted particle, in Figure\ref{fig:particle_insertion}b we plot the distortions of the polymer brush $\Delta \phi = \phi^{\textrm{ins}} - \phi$.
The color code is shown in the legend Figure \ref{fig:particle_insertion}e.
The distortion of the polymer brush is also plot in Figure \ref{fig:particle_insertion}c and Figure \ref{fig:particle_insertion}f in the radial $\Delta \phi(z=z_c, \bm{r})$ and the axial directions $\Delta \phi(\bm{z}, r=0)$, 
respectively.
The positive values of $\Delta \phi > 0$ (red color) correspond to the region enriched with the polymer compared to the undisturbed brush, while $\Delta \phi < 0$ (blue color) correspond to the polymer depletion.

Horizontal axis corresponds to longitudinal coordinate $z$, vertical axis corresponds to the radial coordinate $r$.
For illustrative reasons the colormaps are mirrored along $z$-axis, in a cylindrical coordinate system radial coordinate is always positive.

Consistently with the previous discussion, an inert particle $\chi_{\textrm{PC}} = 0.0$ creates a depleted region (blue) around it $\Delta \phi < 0$, while an attractive particle $\chi_{\textrm{PC}} = -1.5$ creates an enriched region $\Delta \phi > 0$.
When an inert particle of a comparable with the pore size is inserted, the depletion region is followed by non-local increase in the polymer volume concentration as seen in panel b of the upper subfigure in Figure \ref{fig:particle_insertion}.

Notably, when an attractive particle is inserted, the enriched region is followed by non-local change in the polymer concentration, not necessary by the negative change.
When the particle enters the brush, the enriched region in the vicinity of the particle is followed by a non-local depleted region, as the particle progress in the pore, the overall change in the polymer volume concentration is positive everywhere.
This particular case is shown in the lower subfigure of Figure \ref{fig:particle_insertion}.

In the main text Figure 3 we present the insertion free energy calculated by the analytical and SF-SCF methods for a cylindrical particles with varied diameter and height $d=[8, 12, 16]$ moving along the main axis of the pore with radius $r_{pore} = 26$ and membrane thickness $s=52$.

Let us look at the results for the larger particles $d = 16$.

The SF-SCF results of the insertion free energy $\Delta F_{\textrm{SF}}$ for the particles inserted in the polymer brush $|z_c| < 26$ are systematically underestimated by the analytical method. 
As we discussed, it is the manifestation of the non-local perturbations $\Delta \phi$ in the polymer volume concentration $\phi$.

On the contrary, the SF-SCF results for the attractive particles (low $\chi_{\textrm{ads}}$, low $\chi_{\textrm{PC}}$, high $\chi_{\textrm{PS}}$) when they just enter the polymer brush $|z_c| \approx 40$ are overestimated by the analytical method.
(See the result for $d=16, \chi_{\textrm{PC}} = -1, \chi_{\textrm{PS}} = 0.6$ in the main text Figure 3.)
The effect is grasped by the SF-SCF and discussed the previous section of the SI (see Figure \ref{fig:fit_SI}).
When a strongly attractive particle particle comes close to the polymer brush, the brush deforms to create the contact with the particle, that deformations happens to be thermodynamically favorable.
The developed analytical approach can not account for this additional negative effect on the insertion free energy.

\end{multicols}

\begin{figure}[htp!]
    \centering
    \includegraphics[width = 0.7\textwidth]{fig/insertion_chi_PS=0.5_chi_PC=0_d=16_pc=-26.png}\\
    \hspace{0.5cm}
    \includegraphics[width = 0.7\textwidth]{fig/insertion_chi_PS=0.5_chi_PC=-1.5_d=16_pc=-26.png}
    \caption{
        Non-local perturbation in polymer density when a particle with size comparable to pore radius is inserted. 
        %This explains why insertion free energy is underestimated by analytical scheme for a larger particles.
        % $d=16, \chi_{PS} = 0.5, \chi_{PC} = 0$
        % $\Delta \phi = \phi - \phi^{\textrm{empty}}$
        }
    \label{fig:particle_insertion}
\end{figure}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Integration over an arbitrary shaped particle}
\begin{multicols}{2}

Here we present general consideration and formalism on the integration over the particle volume and surface
for an arbitrary shaped particle with the inhomogeneous surface.

Obviously, integration over the solid body volume and surface is a trivial task for a simple geometries like sphere or cylinder.
Our goal is develop an approach that works for Cartesian and curved coordinate systems, computationally efficient, has a discrete form for the integrations on a regular lattice, can be generalized to an arbitrary shaped, positioned and rotated particles with inhomogeneous surface.
The other goal is to exploit system symmetry if possible.

Particular to this paper, we exploit axial symmetry with respect to $z$-axis (properties uniform along the angular axis) to perform computationally efficient calculation on the regular lattice defined on the $rz$ of the cylindrical coordinates.

A three dimensional solid body can be defined with signed distance function $\textrm{SDF}: \mathbb{R}^3 \to \mathbb{R}$, which is negative inside the body and positive outside.

$\textrm{SDF}$ has remarkable properties, it can be rotated, translated and scaled. 
There is a plethora of $\textrm{SDF}$ known for simple geometries like sphere, spheroid, capsule and \textit{etc.}
Moreover, $\textrm{SDF}$ can be easily defined for a affine transformation and Boolean operations on solids, which enables complex geometries.

Consider $\textrm{SDF}(\bm{x})$ is defined for a solid body placed at the origin of Cartesian coordinate system, where $\bm{x} = (x_0, x_1, x_2) \in \mathbb{R}^3$ and $\hat{b}_0, \hat{b}_1, \hat{b}_2$ is the basis.
We apply inverse transform matrix in homogenous coordinates $(x_0, x_1, x_2, 1)$ to construct $\textrm{SDF}$ for an arbitrary translated and rotated solid body (also sheared and scaled).

The rotation is defined as the Euler angles $\bm{\theta} = \theta_0, \theta_1, \theta_2 \in \bm{SO(3)}$.
%We use the next convention for Euler angles: $\theta_0$ - polar angle, $\theta_1$ - azimuthal angle, $\theta_2$ - intrinsic angle; the angles measured to the solid body local coordinate system.
We use the ZYZ convention for Euler angles:
\begin{itemize}
    \item $\theta_0 \in [0, 2\pi)$ - rotation about the $z$-axis, 
    \item $\theta_1 \in [0, \pi)$ - rotation about the $y$-axis, 
    \item $\theta_2 \in [0, 2\pi)$ - rotation about the $z$-axis again.
\end{itemize}


Let us construct $\textrm{SDF}(x_0, x_1, x_2)$ for a translated and rotated solid body.
The rotation and translation can be described as a matrix:

\begin{equation}
    \begin{gathered}
    \bm{M}(\bm{x}^\prime, \bm{\theta}) =
    \\
    \scalemath{0.8}{
        \begin{pmatrix}
            c\theta_2 c\theta_1 c\theta_0 - s\theta_2 s\theta_0 & -c\theta_2 c\theta_1 s\theta_0 - s\theta_2 c\theta_0 & c\theta_2 s\theta_1 & x^{\prime}_0 \\
            s\theta_2 c\theta_1 c\theta_0 + c\theta_2 s\theta_0 & -s\theta_2 c\theta_1 s\theta_0 + c\theta_2 c\theta_0 & s\theta_2 s\theta_1 & x^{\prime}_2 \\
            -s\theta_1 c\theta_0 & s\theta_1 s\theta_0 & c\theta_1 & x^{\prime}_2 \\
            0 & 0 & 0 & 1
        \end{pmatrix}
    }
    %\cdot
    % \\
    % \cdot & 
    % \scalemath{0.8}{
    % \begin{vmatrix}
    % 1&0&0&x_0^{\prime}\\
    % 0&1&0&x_1^{\prime}\\
    % 0&0&1&x_2^{\prime}\\
    % 0&0&0&1
    % \end{vmatrix}
    %}
    \end{gathered}
\end{equation}
where $c$ and $s$ stand for cosine and sine, respectively. 
 
The modified $\textrm{SDF}$ for a translated and rotated solid body:
\begin{equation}
    \textrm{SDF}(\bm{x}, \bm{x}^{\prime}, \bm{\theta}) = \textrm{SDF}_{0}(\bm{M}(\bm{x}^\prime, \bm{\theta})^{-1} (x_0, x_1, x_2, 1)^{T})
\end{equation}
where $\textrm{SDF}_{0}$ is the original function for a solid body placed in the origin of Cartesian coordinates.

Using the $\textrm{SDF}$ we can define an indicator function for the volume that determine whether a given point is inside or outside, indicator function that determine whether a given point is on the surface and the surface normals.

\begin{gather}
    \bm{\delta}_V = H(-\textrm{SDF})\\
    \bm{\delta}_S = \delta(\textrm{SDF})\\
    \hat{\bm{n}} = \nabla \textrm{SDF}
\end{gather}
where $H$ is the Heaviside function, $\delta$ is the Dirac function.

%Let us find orientational average of the volume and surface integral for a function $g(\bm{x})$:
% \begin{gather}
%         \left.G\right|_V (\bm{x}^{\prime}) = \frac{1}{8\pi^2} \iint \limits_{\Omega_{\theta}, V(\bm{x}^{\prime}, \bm{\theta})} g(\bm{x})dV d \bm{\theta}\\
%         \left.G\right|_S (\bm{x}^{\prime}) = \frac{1}{8\pi^2} \iint \limits_{\Omega_{\theta}, S(\bm{x}^{\prime}, \bm{\theta})} g(\bm{x})dS d \bm{\theta}
% \end{gather}
%Note that integration domains depend on the current particle position $\bm{x}^{\prime}$ and orientation $\bm{\theta}$.

Let us find orientational average of the volume and surface integral for a function $g(\bm{x})$ in Cartesian coordinates, we can use the indicator functions to fix the integration domain:
\begin{equation}
    \left.G\right|_V (\bm{x}^{\prime}) = \frac{1}{8\pi^2} \iint 
        \limits_{\substack{
                            % \theta_0 \in [0, 2\pi] \\ 
                            % \theta_1 \in [0, \pi] \\ 
                            % \theta_2 \in [0, 2\pi] \\
                            \bm{\theta} \in \Omega_{\theta} \\
                            \bm{x} \in \mathbb{R}^3}} 
        \delta_V(\bm{x}, \bm{x}^{\prime}, \bm{\theta}) g(\bm{x}) d \bm{x}  \sin \theta_1d \bm{\theta}
\end{equation}

\begin{equation}
    \begin{aligned}
    &\left.G\right|_S (\bm{x}^{\prime}) = \\ & \frac{1}{8\pi^2} \iint 
    \limits_{\substack{
        \bm{\theta} \in \Omega_{\theta} \\
        \bm{x} \in \mathbb{R}^3}}
        \delta_S(\bm{x}, \bm{x}^{\prime}, \bm{\theta}) g(\bm{x}) \cdot 
        \frac{\left|\hat{n}(\bm{x}, \bm{x}^{\prime}, \bm{\theta})\right|}{\left|\hat{n}(\bm{x}, \bm{x}^{\prime}, \bm{\theta}) \cdot \hat{b}_2\right|}  dx_0 dx_1  \sin \theta_1 d \bm{\theta}
    \end{aligned}
\end{equation}
where $\Omega_{\theta}$ domain of possible orientations given in Euler angles, $V(\bm{x}^{\prime}, \bm{\theta}) \in \mathbb{R}^3$, $S(\bm{x}^{\prime}, \bm{\theta}) \in \mathbb{R}^2$ are volume and surface integration domains.

When $g(\bm{x})$ is independent from one of the coordinates, particularly, it can describe a property uniform along one or two coordinate axis.
While the previous equations are still valid, we can redefine some of the equation to drop some dimensions.

%Further we present some examples.

Let $g(\bm{x})$ be uniform in $x_2$ direction, means the function can be redefined as $g(x_0, x_1)$.
We project solid body volume and surface from $\mathbb{R}^3 \to \mathbb{R}^2$.
\begin{equation}\label{eq:x2_down}
    %\begin{aligned}
        %&
        V_{x_2 \downarrow}(x_0, x_1, x^{\prime}_0, x^{\prime}_1, \bm{\theta}) = 
        \int \limits_{x_2 \in \mathbb{R}}
        \bm{\delta}_V dx_2
\end{equation}
\begin{equation}
        S_{x_2 \downarrow}(x_0, x_1, x^{\prime}_0, x^{\prime}_1, \bm{\theta}) = 
        \int \limits_{x_2 \in \mathbb{R}}
        \bm{\delta}_S
        \frac{|\hat{\bm{n}}|}{|\hat{\bm{n}} \cdot \hat{b_2}|} dx_2
    %\end{aligned}
\end{equation}
where $x^{\prime}_2$ in $\bm{x}^{\prime}$ is an arbitrary value.
The integral transformation in eq. \ref{eq:x2_down} is similar to Radon transformation of a solid body into a series of crosscuts.

Orientation averaged integral over the particle volume and surface, when the integrated function is uniform along one of the axis, can be rewritten as:
\begin{equation}
    \begin{aligned}
        &\left.G\right|_V (x_0^{\prime}, x_1^{\prime}) = \\
        \frac{1}{8\pi^2} &\iint \limits_{
            \substack{  \bm{\theta} \in \Omega_{\theta} \\
                        x_0, x_1 \in \mathbb{R}^2
                        }}
        g(x_0, x_1) V_{x_2 \downarrow}(x_0, x_1, x^{\prime}_0, x^{\prime}_1, \bm{\theta}) dx_0 dx_1 \sin\theta_1 d\bm{\theta}
    \end{aligned}
\end{equation}
\begin{equation}
    \begin{aligned}
        &\left.G\right|_S (x_0^{\prime}, x_1^{\prime}) = \\
        \frac{1}{8\pi^2} &\iint \limits_{
            \substack{  \bm{\theta} \in \Omega_{\theta} \\
                        x_0, x_1 \in \mathbb{R}^2
                        }}
        g(x_0, x_1) S_{x_2 \downarrow}(x_0, x_1, x^{\prime}_0, x^{\prime}_1, \bm{\theta}) dx_0 dx_1 \sin\theta_1 d\bm{\theta}
    \end{aligned}
\end{equation}
Remarkably, in we drop one dimension from the integration to ensure efficient computation.

Let $g(\bm{x})$ be uniform in $x_0, x_1$ direction, means the function can be redefined as $g(x_2)$.
We project solid body volume and surface $\mathbb{R}^3 \to \mathbb{R}$.

\begin{equation}\label{eq:x0x1_down}
        V_{x_0, x_1 \downarrow}(x_2, x^{\prime}_2, \theta_1, \theta_2) = 
        \iint \limits_{x_0, x_1 \in \mathbb{R}^2}
        \bm{\delta}_V dx_0 dx_1
\end{equation}
\begin{equation}
    S_{x_0, x_1 \downarrow}(x_2, x^{\prime}_2, \theta_1, \theta_2) = 
    \iint \limits_{x_0, x_1 \in \mathbb{R}^2}
    \bm{\delta}_S \frac{|\hat{\bm{n}}|}{|\hat{\bm{n}} \cdot \hat{b}_0|} dx_0 dx_1
\end{equation}

Orientation averaged integral over the particle volume and surface, when the integrated function is uniform along two axis, can be rewritten as:
\begin{gather}
    \begin{aligned}
        &\left.G\right|_V (x_2^{\prime}) = \\
        \frac{1}{4\pi} &\iint \limits_{
            \substack{  \theta_0 \in [0, 2\pi) \\
                        \theta_1 \in [0, \pi) \\
                        x_2 \in \mathbb{R}
                        }}
        g(x_2) V_{x_0, x_1 \downarrow}(x_2, x^{\prime}_2, \bm{\theta}) dx_0 dx_1 \sin \theta_1 d\theta_0 d\theta_1
    \end{aligned}
    \\
    \begin{aligned}
        &\left.G\right|_S (x_2^{\prime}) = \\
        \frac{1}{4\pi} &\iint \limits_{
            \substack{  \theta_0 \in [0, 2\pi) \\
                        \theta_1 \in [0, \pi) \\
                        x_2 \in \mathbb{R}
                        }}
        g(x_2) S_{x_0, x_1 \downarrow}(x_2, x^{\prime}_2, \bm{\theta}) dx_0 dx_1 \sin \theta_1 d\theta_0 d\theta_1
    \end{aligned}
\end{gather}
Remarkably, not only we drop two dimensions, we reduce the domain of possible orientation.
The third Euler angle in ZYZ do not change the projection, hence the change of the domain and the normalization constant.

The indicator function we introduced earlier have two major benefits.
First, it fixes the domain of integration regardless of the particle translation and rotation.
Second, the integration can be performed in the same manifold for volume and surface.


We might prefer to use other than Cartesian coordinate systems, particularly, a cylindrical coordinate system.
Generally, for an orthogonal curvilinear coordinate system $\bm{q} = q_0, q_1, q_2 \in \mathbb{R}^3$ we define the invertible transformation $\bm{T}:\mathbb{R}^3 \to \mathbb{R}^3$ to Cartesian coordinates and transformation $\bm{T}_h(\bm{q}):\mathbb{R}^3 \to \mathbb{R}^4$ to homogeneous coordinates.

\begin{align}
    \bm{T}(\bm{q}) &= 
    \begin{pmatrix}
        x_0(q_0, q_1, q_2)\\
        x_1(q_0, q_1, q_2)\\
        x_2(q_0, q_1, q_2)\\
    \end{pmatrix}
    \\
    \bm{T}_h(\bm{q}) &= 
    \begin{pmatrix}
        x_0(q_0, q_1, q_2)\\
        x_1(q_0, q_1, q_2)\\
        x_2(q_0, q_1, q_2)\\
        1
    \end{pmatrix}
\end{align}

The final form for the $\textrm{SDF}$ in a curvilinear coordinate system:
\begin{equation}
    \textrm{SDF}(\bm{q}) = \textrm{SDF}_{0}(\bm{M}(\bm{T}(\bm{q}^\prime), \bm{\theta})^{-1} \bm{T}_h(\bm{q}))
\end{equation}
where $\bm{q}^\prime$ is the solid body position in the curvilinear coordinates.


The general expression to calculate volume integral becomes:

\begin{equation}\label{eq:general_int_V}
    \begin{split}
        &\left.G\right|_V (x_0^{\prime}, x_1^{\prime}, x_2^{\prime}) = 
        \\
        &\frac{1}{8\pi^2} \int_{0}^{2\pi}\int_{0}^{2\pi}\int_{0}^{\pi} \iiint \limits_{x_0, x_1, x_2 \in \mathbb{R}^3} g(x_0, x_1, x_2)  \cdot\\
        \cdot &H\left[\textrm{SDF}(x_0 - x_0^{\prime}, x_1 - x_1^{\prime}, x_2 - x_2^{\prime}, \theta_0, \theta_1, \theta_2)\right] \cdot \\
        \cdot &J dx_0 dx_1 dx_2 d\theta_0 d\theta_1 d\theta_2 
    \end{split}
\end{equation}
where 
\begin{equation}
    J = \begin{vmatrix}
        \frac{\partial \hat{e}_0}{\partial x_0} & \frac{\partial \hat{e}_0}{\partial x_1} & \frac{\partial \hat{e}_0}{\partial x_2} \\
        \frac{\partial \hat{e}_1}{\partial x_0} & \frac{\partial \hat{e}_1}{\partial x_1} & \frac{\partial \hat{e}_1}{\partial x_2} \\
        \frac{\partial \hat{e}_2}{\partial x_0} & \frac{\partial \hat{e}_2}{\partial x_1} & \frac{\partial \hat{e}_2}{\partial x_2} \\
    \end{vmatrix}
\end{equation}
is Jacobian matrix of the curvilinear coordinate system. $\hat{e}_0, \hat{e}_1, \hat{e}_2$ local covariant basis vectors of the chosen coordinate system,  $\hat{e}_0, \hat{e}_1, \hat{e}_2$ basis of a local Cartesian coordinate.

The general expression to calculate surface integral:

\begin{equation}\label{eq:general_int_S}
    \begin{split}
        &G_{S}(x_0^{\prime}, x_1^{\prime}, x_2^{\prime}) = \\
        &\frac{1}{8\pi^2} \int_{0}^{2\pi}\int_{0}^{2\pi}\int_{0}^{\pi} \iiint \limits_{x_0, x_1, x_2 \in \mathbb{R}^3} g(x_0, x_1, x_2)  \cdot\\
        \cdot &\delta\left[\textrm{SDF}(x_0 - x_0^{\prime}, x_1 - x_1^{\prime}, x_2 - x_2^{\prime}, \theta_0, \theta_1, \theta_2)\right] \cdot \\
        &\frac{\nabla \textrm{SDF}}{\nabla \textrm{SDF} \cdot \hat{x}_2} \left| \frac{\partial \hat{e}_0}{\partial x_0} \times \frac{\partial \hat{e}_1}{\partial x_1}  \right| dx_0 dx_1 dx_2 d\theta_0 d\theta_1 d\theta_2 
    \end{split}
\end{equation}
where $\delta(x)$ is the Dirac function. 

Eq.\ref{eq:general_int_V} can be easily generalized to account for inhomogeneous surface properties by introducing addition term to the integrand.
This term can be defined as $h{u(x_0, x_1, x_2), v(x_0, x_1, x_2)}$, to encode surface properties as a $uv$-map.

Particularly, a property uniform in one of the coordinates (\textit{e. g} Flory osmotic pressure $\Pi$ is uniform in the angular direction) can be defined as a function of two independent spatial variables $g(x_0, x_1)$.
Let us omit rotational dependency, for the sake of clarity.
As the function $g(x_0, x_1)$ defined in $\mathbb{R}^2$, we project the particle volume and surface from $\mathbb{R}^3$ to $\mathbb{R}^2$ by the next integral transform:

\begin{equation}
    \begin{split}
        &V(x_0^{\prime}, x_1^{\prime}) =\\
        & \int \limits_{x_2 \in \mathbb{R}} H\left[\textrm{SDF}(x_0 - x_0^{\prime}, x_1 - x_1^{\prime}, x_2 - x_2^{\prime})\right] \left|\frac{\partial \hat{e}_2}{\partial x_2}\right| dx_2
    \end{split}
\end{equation}

\begin{equation}
    \begin{split}
        &S(x_0^{\prime}, x_1^{\prime}) =\\
        & \int \limits_{x_2 \in \mathbb{R}} \delta\left[\textrm{SDF}(x_0 - x_0^{\prime}, x_1 - x_1^{\prime}, x_2 - x_2^{\prime})\right] \\
        &\frac{\nabla \textrm{SDF}}{\nabla \textrm{SDF} \cdot \hat{x}_2} \left| \frac{\partial \hat{e}_0}{\partial x_0} \times \frac{\partial \hat{e}_1}{\partial x_1}  \right| dx_2
    \end{split}
\end{equation}

\begin{equation}
    G_{V}(x_0^{\prime}, x_1^{\prime}) = \iint \limits_{x_0, x_1 \in \mathbb{R}^2} g(x_0, x_1) \cdot V(x_0, x_1) dx_0 dx_1
\end{equation}

\begin{equation}
    G_{S}(x_0^{\prime}, x_1^{\prime}) = \iint \limits_{x_0, x_1 \in \mathbb{R}^2} g(x_0, x_1) \cdot S(x_0, x_1) dx_0 dx_1
\end{equation}

Generalization to orientation dependent integration will result in a transform similar to the Radon transform.

    
\end{multicols}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Integration over spherical particle}
\begin{multicols}{2}

In the previous section we discuss the integration over the cylindrical particle volume and surface.
Here we generalize the idea to a homogeneous spherical particle with an arbitrary position of the center.

The concept is easier to present in the $xyz$ Cartesian coordinates first. 

Consider a function of interest $g(x,y,z)$, we want to integrate it over the particle volume $G = \int_{V_{\textrm{sphere}}} g dV$.

Let us define spherical the particle volume using signed distance function:
\begin{eqnarray}
    %\begin{split}
    %    &\textrm{SDF}(x,y,z, x_c, y_c, z_c) =\\
    %    &\sqrt{(x-x_c)^2 + (y-y_c)^2 + (z-z_c)^2} - d/2
    %\end{split}
    \textrm{SDF}(x,y,z) = \sqrt{(x)^2 + (y)^2 + (z)^2} - d/2 \\
    V(x,y,z) = H(-SDF(x,y,z)) \\
    \iiint \limits_{(x,y,z)\in \mathbb{R}^3} V(x,y,z) dx dy dz = V_{\textrm{sphere}}
\end{eqnarray}
where $H$ is a Heaviside step function, $V_{\textrm{sphere}} = \frac{\pi d^3}{6}$ is the volume of a spherical particle.

Let us place a particle to have the coordinates of the particle's center $x_c, y_c, z_c$. 
Then we integrate the function $g(x,y,z)$ in the $xyz$-space
\begin{equation}
    \begin{split}
    &G(x_c, y_c, z_c) = \\
    &\iiint \limits_{(x,y,z)\in \mathbb{R}^3} g(x, y, z) V(x-x_c,y-y_c,z-z_c) dx dy dz
    \end{split}
\end{equation}

Finally, let $G(x,y,z)$ be the value of the integral for an arbitrary particle position:
\begin{equation}\label{eq:g_v_conv}
    G(x,y,z) = (\bm{g} \ast \bm{V})(x,y,z)
\end{equation}

In a coarse-grained calculation one can expect $g[i,j,k]$ to be defined on the regular grid.
The eq. \ref{eq:g_v_conv} remains valid in a discrete form.
\begin{equation}\label{eq:g_v_conv_dicsrete}
    G[i,j,k] = (\bm{g} \ast \bm{V})[i,j,k]
\end{equation} 
Similar to projections matrices in the previous section of SI [\dots], we define $V_{\textrm{sphere}}[i,j,k]$:

\begin{gather}\label{eq:v_dicsrete_3d}
    V[i,j,k] = \iiint \limits_{i, j, k}^{\substack{i+\delta x\\ j+\delta y\\ k+\delta z}} V(x,y,z) dx dy dz
    \\
    \sum_{i,j,k} V[i,j,k] = \frac{\pi d^3}{6} \qquad
    \begin{matrix}
        i \in [0, d/\delta i) \\ j \in [0, d/\delta j) \\ k \in [0, d/\delta z)
    \end{matrix}
\end{gather}

where $\delta x, \delta y, \delta z$ is a grid step in the respective directions.
This discretized volume $V_{\textrm{sphere}}$ is a coarse-grained voxel representation of a sphere with diameter $d$.

Consider a function $g(x,y)$ that defines a property uniform in $z$-direction, the function of interest $g(x,y)$ and $G(x,y)$ are independent on $z$ coordinate.
We exploit this fact and perform computation efficiently in $\mathbb{R}^2$ space.

Let us project spherical particle volume to $xy$-plane with a next transformation:
\begin{equation}
    V(x,y) = \int_{-\infty}^{+\infty} V(x,y,z) dz
\end{equation}

Following the same steps that leads to eq.\ref{eq:v_dicsrete_3d}, the discrete form is:
\begin{gather}
    V[i,j] = \iint \limits_{i, j}^{\substack{i+\delta x\\ j+\delta y}} V(x,y) dx dy
    \\
    \sum_{i,j} V[i,j] = \frac{\pi d^3}{6} \qquad
    \begin{matrix}
        i \in [0, d/\delta i) \\ j \in [0, d/\delta j)
    \end{matrix}
\end{gather}

Eq. \ref{eq:g_v_conv},\ref{eq:g_v_conv_dicsrete} are redefined as:
\begin{eqnarray}
    G(x,y) = (\bm{g} \ast \bm{V})(x,y)\\
    G[i,j] = (\bm{g} \ast \bm{V})[i,j]
\end{eqnarray}






\begin{figure}[H]
        \centering
        \includegraphics[scale = 0.7]{fig/spherical_kernel.png}
        \caption{
            Spherical particle volume and surface projection in a cylindrical lattice.
            % The particle has the center offset from the cylindrical lattice $z$ axis used in discretization.
            % \\
            % To construct particle volume element matrix $v[k,i]$, for each lattice element (yellow opaque square toroid) one determines volume of the lattice element occupied by the particle (red body, marked with the word 'volume').
            % \\
            % To construct particle surface element matrix $s[k,i]$, for each lattice element (yellow opaque square toroid) one determines surface of the lattice element occupied by the particle (green surfaces, marked with the word 'surface').
            % \\
            % As an example, volume element matrix $v[k,i]$ is shown as a blue-green-yellow colormap, 
            % where blue color means the lattice element is not occupied by the particle.
            % \\
            % For this figure a spherical particle with $d=16$ were selected, the center of the particle has a radial offset $r_c=8$ and arbitrary $z_c$ coordinate,
            % $i \in [0,15]$, $k \in [0,15]$.
        }
        \label{fig:spherical_kernel}
    \end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[scale = 0.7]{fig/spherical_kernel_2.png}
    \caption{
        Spherical particle volume and surface projection in a cylindrical lattice, $z$-plane view.
    }
    \label{fig:spherical_kernel}
\end{figure}
    
\end{multicols}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection*{Excluded volume effect}

\begin{figure}
    \centering
    \includegraphics[scale = 1.2]{fig/excluded_volume_SI.png}
    \caption{
        Excluded volume as morphological binary dilation
        }
    \label{fig:excluded_volume}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[scale = 0.7]{fig/convolution_scheme.png}
    \caption{
        Excluded volume, local mobility. 
        Osmotic pressure by Flory, convoluted to get $\Delta F_{osm} = \Pi \ast v$. Surface tension coefficient $\gamma(\phi, b_0, b_1)$ is found using coefficients fitted $b0, b1$, convoluted to get $\Delta F_{sur} = \gamma \ast s$.
        }
    \label{fig:convolution_scheme}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[scale = 0.7]{fig/conductivity_hm.png}
    \caption{
        Free energy landscape arise from the combination of $\Delta F = \Delta F_{osm} + \Delta F_{osm}$. Combined with mobility $D/D_0$ we get local conductivity $\rho^{-1} = D \exp (-\Delta F)$.
        }
    \label{fig:conductivity_hm}
\end{figure}


\begin{figure}
    \centering
    \includegraphics[scale = 0.7]{fig/resistance_integration.png}
    \caption{
        Numeric integration of local conductivity/resistance on the cylindrical lattice to calculate total resistance of the pore. 
        Done separately for channel and the regions outside the pore.
        Outside the pore, ever increasing cylindrical caps.
        Inside circle cross-sections. $R_{\textrm{convergent}} = R_{in} + R_{out}$.
        Mimics oblate spheroid iso-concentration profile of analytical solution to an empty pore problem.
        The area of cylindrical caps (red) is corrected as they underestimate resistance.
        }
    \label{fig:integration_scheme}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[scale = 0.7]{fig/main_figure.png}
    \caption{
    OLD TEXT
    Schematic cutaway diagram of system geometry, space discretization, boundary conditions and polymer brush morphology.
    The radial axis $r$ (1) and the axis $z$ (2) defines cylindrical coordinates with degenerate angular coordinates.
    If $z$ is held constant a flat circular plane is traced, $z=0$ traces a plane at the origin (3). 
    If $r$ is held constant a cylindrical surface is traced.
    The space is discretized using regular 2D grid (4) with element size $\delta z = \delta r = a$, where $a$ is Kuhn segment length.
    Each element of the grid has a finite volume equal to a square toroid traced by the cylindrical and circular surfaces (5).
    \\
    The studied system is a pore in an infinite solvent reservoir (6).
    The pore walls (7) are rigid body impermeable for particles and polymer brush. The inner surface of a pore is grafted with homopolymer chains (8) with grafting density $\sigma$ and degree of polymerization $N$, 
    the grafting surface (9) is pictured as red straight line on the horizontal cross-section plane.
    \\
    Spherical particles (10) with diameter $d$ diffuse from the left semi-infinite reservoir. 
    The ingress of particles shown with green arrows(11) and simulated as a source with constant concentration of particles $c_0$ placed far from the pore.
    \\
    The egress of particles shown with red arrows(12) and simulated as a perfect sink with constant concentration of particles $c=0$ placed far from the pore.
    \\
    Particles are discretized by grid elements occupancy, e.g. how much of a particle volume occupy grid element volume. The discretization of particle volume is shown as a heatmap (13) under the particle.  
    \\
    The polymer volume concentration profile ($\phi$) has axial symmetry the profile is presented as a heatmap on the vertical cross-section plane. 
    The particle stationary concentration profile normalized by the bulk concentration ($c/c_0$) is a heatmap on the horizontal cross-section plane.
        }
    \label{fig:cutaway_diagram}
\end{figure}


\begin{figure}
    \centering
    \includegraphics[scale = 0.7]{fig/CFD_element.png}
    \caption{
        About computation fluid dynamics (CFD) finite volume cell, its divergence and time discretization.
        }
    \label{fig:integration_scheme}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[scale = 0.7]{fig/permeability_on_d_detailed.png}
    \caption{
        Same as in the main text, but contributions of convergent flow and the channel are shown separately.
        }
    \label{fig:permeability_on_d_detailed}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[scale = 0.7]{fig/permeability_on_d_low_D.png}
    \caption{
        Same as in the main text, but local mobility is lower, as if particle larger.
        }
    \label{fig:permeability_ond_low_D}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[scale = 0.7]{fig/resistivity_contourplot_low_D.png}
    \caption{
        Same as in the main text, but local mobility is lower, as if particle larger. 
        }
    \label{fig:resistivity_contourplot_low_d}
\end{figure}


\end{document}